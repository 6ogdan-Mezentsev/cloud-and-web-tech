# 2 лабораторная работа "DevOps" - настройка Docker compose

## Задание

1. Написать “плохой” Docker compose файл, в котором есть не менее трех “bad practices” по их написанию
2. Написать “хороший” Docker compose файл, в котором эти плохие практики исправлены
3. В Readme описать каждую из плохих практик в плохом файле, почему она плохая и как в хорошем она была исправлена, как исправление повлияло на результат
4. После предыдущих пунктов в хорошем файле настроить сервисы так, чтобы контейнеры в рамках этого compose-проекта так же поднимались вместе, но не "видели" друг друга по сети. В отчете описать, как этого добились и кратко объяснить принцип такой изоляции

## Описание плохих практик для Docker compose и их исправление:

Далее будет рассмотрены варинаты docker compose файлов (плохой/хороший) для поднятия контейнеров с ручкой api на фреймворке Express и контейнера на Nginx, раздающего статику.

### 1. Широкий build-context

```
context: .
```

Почему плохо:

В плохом файле в образ отправляется весь репозиторий, что увеличивает сборку и может прихватить лишние файлы.

Как исправить:

```
context: ./pr1
```

Теперь в образ попадает только код express-приложения. Сборка быстрее и безопаснее.

### 2. Теряем сетевую изоляцию и контроль портов

```
network_mode: host
```

Почему плохо:

Контейнеры делят сетевой стек хоста, не изолируются друг от друга и конфликтуют по портам.

Как исправить:

Каждый сервис подключён к собственному bridge-сетевому сегменту (`express_net`, `static_net`), а доступ пользователю обеспечивается пробросом портов.

### 3. Неприкреплённый тег образа

```
image: nginx:latest
```

Почему плохо:

Нельзя гарантировать одинаковое поведение между запусков — подтащится любая свежая версия.

Как исправить:

```
image: nginx:1.25-alpine
```

Поведение воспроизводимое, образ меньше.

## Изоляция конейнеров по сети

Создал разные bridge-сети (express_net и static_net), чтобы конетейнеры не видели друг друга по внутренней сети. В итоге контейнеры запускаются одновременно, но изолированны на уровне сети.

## Демонстрация успешной работы контейнеров
- Запустив команду docker compose up получаем следующий вывод в терминал:
<img width="1110" height="508" alt="image" src="https://github.com/user-attachments/assets/5f8b081f-d481-4ba5-a724-a426e31a2e82" />

- Зайдя по адресу фронта localhost:8080 и нажав на кнопку запросить api/hello, получаем следующий вывод, который символизирует о том, что контейнеры не видят друг друга:
<img width="1918" height="334" alt="image" src="https://github.com/user-attachments/assets/1a163bed-7fbb-4d82-ac7a-d7021586d8ce" />

- При этом ручка Express работает как надо:
<img width="921" height="144" alt="image" src="https://github.com/user-attachments/assets/acfa38e8-5474-496c-96eb-6c72263892c3" />

## Вывод

В ходе лабораторной работы были рассмотрены и продемонстрированы как плохие, так и хорошие практики написания Docker Compose файлов. Была реализована сетевая изоляция контейнеров в рамках одного Compose-проекта через создание отдельных Docker сетей и настройку networks для каждого сервиса. Это позволяет сервисам работать независимо, не взаимодействуя друг с другом, что повышает безопасность и предотвращает нежелательные связи между компонентами системы. Правильно настроенный Docker Compose файл обеспечивает воспроизводимость, безопасность и стабильность работы контейнеризованных приложений.
